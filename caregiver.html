<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Caregiver</title>
  <link rel="stylesheet" href="welcome.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    .container {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 40px;
      border-radius: 25px;
      color: #000;
      width: 90%;
      max-width: 1100px;
      margin-top: 40px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(10px);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    .card {
      background: rgba(255, 255, 255, 0.3);
      padding: 25px;
      border-radius: 20px;
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }

    h1, h2 {
      color: #1a2b44;
    }

    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }

    button {
      background: linear-gradient(to right, #c084fc, #a855f7);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .quick-button {
      background-color: #3b82f6;
    }

    .top-right-buttons {
      margin-right: 30px; /* adds space from right edge */
      display: flex;
      align-items: center;
    }

    /* Or directly add margin-right on the button */
    .logout-btn {
      background-color: #5a4fcf;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.3s ease;

      margin-right: 30px; /* pushes it left by adding right margin */
    }

    .logout-btn:hover {
      background-color: #4036a2;
    }


    .emergency-popup {
      position: fixed;
      top: 20px;
      right: 100px;
      background: red;
      color: white;
      padding: 15px 20px;
      font-weight: bold;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.4);
      z-index: 9999;
    }

    /* New styles for mood logs */
    #userTodayMoodLogs {
      padding: 15px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 15px;
      font-family: 'Inter', sans-serif;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      max-height: 300px;
      overflow-y: auto;
    }

    .mood-log-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,0.7);
      margin-bottom: 10px;
      padding: 10px 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      font-size: 15px;
    }

    .mood-info {
      flex-grow: 1;
    }

    .mood-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      color: white;
      min-width: 80px;
      text-align: center;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
      margin-left: 15px;
      font-size: 14px;
      text-transform: capitalize;
    }

    /* Mood color badges */
    .mood-badge.Okay {
      background-color: goldenrod;
    }

    .mood-badge.Angry {
      background-color: crimson;
    }

    .mood-badge.Neutral {
      background-color: gray;
    }

    .mood-badge.Happy {
      background-color: #3b82f6; /* blue */
    }

    .mood-badge.Sad {
      background-color: #5a4fcf; /* purple */
    }

    /* Completed reminders list container */
    #completedRemindersList {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 10px;
      padding-left: 0;
      list-style: none;
      font-family: 'Inter', sans-serif;
    }

    /* Each completed reminder item */
    #completedRemindersList li {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.75);
      margin-bottom: 12px;
      padding: 14px 20px;
      border-radius: 15px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.07);
      font-size: 16px;
      color: #1a2b44;
      font-weight: 600;
    }

    /* Tick icon before text */
    #completedRemindersList li::before {
      content: "\2713";  /* Unicode checkmark */
      color: #3b82f6; /* nice blue */
      font-weight: bold;
      margin-right: 15px;
      font-size: 20px;
      flex-shrink: 0;
    }

    /* Time label on right side in lighter color */
    #completedRemindersList li span.time {
      margin-left: auto;
      font-weight: 400;
      font-size: 14px;
      color: #555;
      font-style: italic;
    }

    /* Small Clear History button styling */
    #clearHistoryBtn {
      margin-top: 10px;
      background: #ef4444;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 2px 6px rgba(239, 68, 68, 0.6);
      transition: background-color 0.3s ease;
      width: auto;
    }

    #clearHistoryBtn:hover {
      background-color: #b91c1c;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <div class="logo-title">
      <div class="logo-circle">
        <div class="heart"></div>
      </div>
      <div class="title">CareCue</div>
    </div>
    <div class="top-right-buttons">
      <a href="introduction.html" class="logout-btn">Logout</a>
    </div>
  </div>

  <div class="container">
    <h1>Caregiver Mode</h1>

    <div class="grid">
      <div class="card">
        <h2>Add/Update Schedule</h2>
        <div style="padding: 0 10px; display: flex; flex-direction: column; gap: 10px;">
          <input type="text" id="title" placeholder="E.g., Morning Pills or Walk Reminder" />
          <input type="time" id="time" />
          <input type="date" id="date" />
          <button onclick="saveSchedule()">ðŸ’¾ Save Schedule</button>
        </div>
      </div>

      <div class="card" id="reminderStatusCard">
        <h2>Today's Reminder Status</h2>
        <!-- completed reminders list will be inserted here -->
        <button id="clearHistoryBtn">Clear History</button>
      </div>
    </div>

    <div class="card" style="margin-top: 30px; width: 90%;">
      <h2>User's Mood Logs Today</h2>
      <div id="userTodayMoodLogs">Loading today's moods...</div>
    </div>
  </div>

  <script>
    function saveSchedule() {
      const title = document.getElementById('title').value.trim();
      const time = document.getElementById('time').value;
      const date = document.getElementById('date').value;

      if (!title || !time || !date) {
        alert("Please fill all fields: title, time, and date!");
        return;
      }

      let schedules = JSON.parse(localStorage.getItem('schedules')) || [];
      schedules.push({ title, time, date });
      localStorage.setItem('schedules', JSON.stringify(schedules));

      alert(`Saved: ${title} at ${time} on ${date}`);

      document.getElementById('title').value = '';
      document.getElementById('time').value = '';
      document.getElementById('date').value = '';
    }

    function renderTodayUserMoods() {
      const moodLogContainer = document.getElementById("userTodayMoodLogs");
      if (!moodLogContainer) return;

      const logs = JSON.parse(localStorage.getItem('moodLogs')) || [];

      const todayDateStr = new Date().toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });

      const todaysLogs = logs.filter(log => log.date === todayDateStr);

      if (todaysLogs.length === 0) {
        moodLogContainer.textContent = "No moods logged today by the user.";
        return;
      }

      moodLogContainer.innerHTML = "";
      todaysLogs.forEach(log => {
        const entry = document.createElement("div");
        entry.className = "mood-log-entry";
        entry.style.flexDirection = "column";

        const topLine = document.createElement("div");
        topLine.textContent = `${log.intensity}% intensity at ${log.time}`;
        topLine.style.fontWeight = "600";
        topLine.style.marginBottom = "8px";

        const moodClass = log.mood.replace(/\s+/g, '');
        const badge = document.createElement("div");
        badge.className = `mood-badge ${moodClass}`;
        badge.textContent = log.mood;

        entry.appendChild(topLine);
        entry.appendChild(badge);

        moodLogContainer.appendChild(entry);
      });
    }

    function renderReminderSummary() {
      const schedules = JSON.parse(localStorage.getItem('schedules')) || [];
      const completed = JSON.parse(localStorage.getItem('completedReminders')) || [];
      const today = new Date().toISOString().split('T')[0];

      // Filter today's reminders
      const todaysSchedules = schedules.filter(item => item.date === today);
      const todaysCompleted = completed.filter(item => item.date === today);

      const totalCount = todaysSchedules.length;
      const completedCount = todaysCompleted.length;

      const reminderStatusCard = document.getElementById('reminderStatusCard');

      // Update header with counts
      reminderStatusCard.querySelector('h2').textContent = `Today's Reminder Status (${completedCount} / ${totalCount} completed)`;

      // Create or clear list container
      let listEl = document.getElementById('completedRemindersList');
      if (!listEl) {
        listEl = document.createElement('ul');
        listEl.id = 'completedRemindersList';
        listEl.style.marginTop = '10px';
        listEl.style.paddingLeft = '20px';
        reminderStatusCard.insertBefore(listEl, document.getElementById('clearHistoryBtn'));
      }
      listEl.innerHTML = '';

      if (completedCount === 0) {
        listEl.innerHTML = '<li>No reminders completed today.</li>';
      } else {
        todaysCompleted.forEach(reminder => {
          const li = document.createElement('li');
          li.textContent = `${reminder.title} at ${reminder.time}`;
          listEl.appendChild(li);
        });
      }
    }

    // Clear history button functionality
    document.addEventListener('DOMContentLoaded', () => {
      const clearBtn = document.getElementById('clearHistoryBtn');
      clearBtn.addEventListener('click', () => {
        localStorage.removeItem('completedReminders');
        renderReminderSummary();
      });
    });

    // Run on page load
    window.onload = function () {
      renderTodayUserMoods();
      renderReminderSummary();
    };

    // Refresh reminder summary every 5 seconds for live update
    setInterval(renderReminderSummary, 5000);

    if ("Notification" in window && Notification.permission !== "granted") {
      Notification.requestPermission();
    }

    let lastSeenId = localStorage.getItem("lastEmergencySeen") || "0";

    setInterval(() => {
      const currentId = localStorage.getItem("emergencyTriggered");

      if (currentId && currentId !== lastSeenId) {
        lastSeenId = currentId;
        localStorage.setItem("lastEmergencySeen", currentId);

        const popup = document.createElement("div");
        popup.className = "emergency-popup";
        popup.innerHTML = "ðŸš¨ Emergency Triggered!";
        document.body.appendChild(popup);
        setTimeout(() => popup.remove(), 5000);

        if (Notification.permission === "granted") {
          new Notification("ðŸš¨ Emergency Alert", {
            body: "An emergency was triggered by the user!",
            icon: "https://cdn-icons-png.flaticon.com/512/565/565547.png"
          });
        }
      }
    }, 1000);
  </script>

</body>
</html>
